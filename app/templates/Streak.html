{% extends 'base.html'%}

{% block content%}
<!-- Include the Chart.js library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Add a canvas element to the HTML where the chart will be rendered -->
<canvas id="heatmap"></canvas>

<script>
    // Retrieve the heatmap data from the Flask route
    const heatmapData = {{ heatmap_data| safe }};

    // Define the color gradient for the green scale
    const greenGradient = [
        '#e8f5e9',
        '#c8e6c9',
        '#a5d6a7',
        '#81c784',
        '#66bb6a',
        '#4caf50',
        '#43a047',
        '#388e3c',
        '#2e7d32',
        '#1b5e20'
    ];

    // Create a new Chart.js heatmap chart using the heatmap data
    new Chart('heatmap', {
        type: 'heatmap',
        data: {
            datasets: [{
                data: heatmapData,
                borderWidth: 1,
                borderColor: 'rgba(0, 0, 0, 0.1)',
                backgroundColor: function (value, context) {
                    // Set the color of each cell based on the streak value
                    const streak = value.streak;
                    if (streak === 0) {
                        return '#ffffff'; // white
                    } else {
                        // Calculate the index based on the streak value and the length of the gradient array
                        const index = Math.min(streak, greenGradient.length - 1);
                        return greenGradient[index];
                    }
                },
            }],
        },
        options: {
            // Configure the appearance of the chart
            scales: {
                xAxes: [{
                    type: 'time',
                    time: {
                        unit: 'day',
                        displayFormats: {
                            day: 'MMM D',
                        },
                    },
                }],
                yAxes: [{
                    ticks: {
                        reverse: true,
                    },
                }],
            },
            tooltips: {
                enabled: false,
            },
            legend: {
                display: false,
            },
            layout: {
                padding: {
                    top: 10,
                    right: 20,
                    bottom: 20,
                    left: 10,
                },
            },
        },
    });
</script>

<p class="body"> Nothing here yet will be page for charts and other metrics</p>
{% endblock %}